<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FNOS FRP 管理器</title>
    <meta name="description" content="飞牛NAS FRP客户端图形化配置管理工具">
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <!-- Setup Page -->
    <div id="setup-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                </div>
                <h1>FNOS FRP 管理器</h1>
                <p class="auth-subtitle">首次使用，请设置管理密码</p>
                <form id="setup-form">
                    <div class="form-group">
                        <label>管理密码</label>
                        <input type="password" id="setup-password" placeholder="请输入管理密码" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label>确认密码</label>
                        <input type="password" id="setup-confirm" placeholder="请再次输入密码" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">设置密码并进入</button>
                </form>
                <div id="setup-error" class="error-msg hidden"></div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page hidden">
        <div class="auth-container">
            <div class="auth-card">
                <div class="auth-logo">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                    </svg>
                </div>
                <h1>FNOS FRP 管理器</h1>
                <p class="auth-subtitle">请输入管理密码</p>
                <form id="login-form">
                    <div class="form-group">
                        <label>密码</label>
                        <input type="password" id="login-password" placeholder="请输入管理密码" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">登录</button>
                </form>
                <div id="login-error" class="error-msg hidden"></div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-page" class="page hidden">
        <!-- Header -->
        <header class="app-header">
            <div class="header-left">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
                </svg>
                <h1>FNOS FRP 管理器</h1>
            </div>
            <div class="header-right">
                <div class="frpc-status" id="frpc-version-badge">
                    <span class="dot dot-gray"></span>
                    <span id="frpc-version-text">检测中...</span>
                </div>
                <div class="header-links">
                    <a href="https://github.com/ZhensJoke/fnos-frpc" target="_blank" class="btn btn-sm btn-ghost"
                        title="GitHub">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z" />
                        </svg>
                    </a>
                    <a href="https://blog.fyun.org" target="_blank" class="btn btn-sm btn-ghost" title="作者博客">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 013 3L7 19l-4 1 1-4L16.5 3.5z" />
                        </svg>
                    </a>
                    <button class="btn btn-sm btn-ghost" id="btn-theme-toggle" title="切换主题">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" id="theme-icon">
                            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z" />
                        </svg>
                    </button>
                </div>
                <div class="header-divider"></div>
                <button class="btn btn-sm btn-ghost" id="btn-frpc-manage" title="frpc 版本管理">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.66 0 3-4 3-9s-1.34-9-3-9m0 18c-1.66 0-3-4-3-9s1.34-9 3-9m-9 9a9 9 0 019-9" />
                    </svg>
                </button>
                <!-- frpc 未安装提醒气泡 -->
                <div class="frpc-tooltip hidden" id="frpc-tooltip">
                    💡 点击上方 🌐 按钮可管理 frpc 版本
                </div>
                <button class="btn btn-sm btn-ghost" id="btn-logout" title="退出登录">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" />
                    </svg>
                </button>
            </div>
        </header>

        <div class="app-body">
            <!-- Sidebar: Server List -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h2>服务器列表</h2>
                    <button class="btn btn-sm btn-primary" id="btn-add-server" title="添加服务器">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="3">
                            <path d="M12 5v14M5 12h14" />
                        </svg>
                    </button>
                </div>
                <div class="server-list" id="server-list">
                    <div class="empty-state">
                        <p>暂无服务器</p>
                        <p class="text-muted">点击 + 添加第一个</p>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- No server selected -->
                <div id="no-selection" class="empty-main">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"
                        opacity="0.3">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2" />
                        <line x1="8" y1="21" x2="16" y2="21" />
                        <line x1="12" y1="17" x2="12" y2="21" />
                    </svg>
                    <p>选择左侧服务器查看配置</p>
                </div>

                <!-- Server Detail -->
                <div id="server-detail" class="hidden">
                    <!-- Server Config Section -->
                    <section class="config-section">
                        <div class="section-header">
                            <h2 id="server-detail-name">服务器配置</h2>
                            <div class="section-actions">
                                <button class="btn btn-sm" id="btn-toggle-server">
                                    <span class="status-indicator" id="server-running-dot"></span>
                                    <span id="btn-toggle-text">启动</span>
                                </button>
                                <button class="btn btn-sm btn-ghost" id="btn-edit-server" title="编辑">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7" />
                                        <path d="M18.5 2.5a2.12 2.12 0 013 3L12 15l-4 1 1-4 9.5-9.5z" />
                                    </svg>
                                </button>
                                <button class="btn btn-sm btn-ghost btn-danger" id="btn-delete-server" title="删除">
                                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2">
                                        <polyline points="3 6 5 6 21 6" />
                                        <path
                                            d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="config-grid" id="server-config-grid">
                            <!-- Filled by JS -->
                        </div>
                    </section>

                    <!-- Proxy List Section -->
                    <section class="config-section">
                        <div class="section-header">
                            <h2>代理规则</h2>
                            <button class="btn btn-sm btn-primary" id="btn-add-proxy">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="3">
                                    <path d="M12 5v14M5 12h14" />
                                </svg>
                                添加规则
                            </button>
                        </div>
                        <div class="proxy-table-wrap">
                            <table class="proxy-table" id="proxy-table">
                                <thead>
                                    <tr>
                                        <th>名称</th>
                                        <th>类型</th>
                                        <th>本地地址</th>
                                        <th>远程端口/域名</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="proxy-table-body">
                                </tbody>
                            </table>
                            <div id="proxy-empty" class="empty-state hidden">
                                <p>暂无代理规则</p>
                            </div>
                        </div>
                    </section>

                    <!-- Logs Section -->
                    <section class="config-section">
                        <div class="section-header">
                            <h2>运行日志</h2>
                            <button class="btn btn-sm btn-ghost" id="btn-refresh-logs">刷新</button>
                        </div>
                        <pre class="log-viewer" id="log-viewer">暂无日志</pre>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- Server Edit Modal -->
    <div class="modal-overlay hidden" id="modal-server">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-server-title">添加服务器</h3>
                <button class="btn-close" onclick="closeModal('modal-server')">&times;</button>
            </div>
            <form id="server-form">
                <div class="form-group">
                    <label>名称 <span class="required">*</span></label>
                    <input type="text" id="sf-name" placeholder="如：我的VPS" required>
                </div>
                <div class="form-row">
                    <div class="form-group flex-2">
                        <label>服务器地址 <span class="required">*</span></label>
                        <input type="text" id="sf-addr" placeholder="如：frps.example.com" required>
                    </div>
                    <div class="form-group flex-1">
                        <label>端口 <span class="required">*</span></label>
                        <input type="number" id="sf-port" placeholder="7000" required>
                    </div>
                </div>
                <div class="form-group">
                    <label>认证 Token</label>
                    <input type="text" id="sf-token" placeholder="可选">
                </div>
                <div class="form-row">
                    <div class="form-group flex-1">
                        <label>用户名</label>
                        <input type="text" id="sf-user" placeholder="可选">
                    </div>
                    <div class="form-group flex-1">
                        <label class="checkbox-label">
                            <input type="checkbox" id="sf-tls"> 启用 TLS
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('modal-server')">取消</button>
                    <button type="submit" class="btn btn-primary" id="btn-save-server">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Proxy Edit Modal -->
    <div class="modal-overlay hidden" id="modal-proxy">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-proxy-title">添加代理规则</h3>
                <button class="btn-close" onclick="closeModal('modal-proxy')">&times;</button>
            </div>
            <form id="proxy-form">
                <div class="form-row">
                    <div class="form-group flex-2">
                        <label>名称 <span class="required">*</span></label>
                        <input type="text" id="pf-name" placeholder="如：ssh, web" required>
                    </div>
                    <div class="form-group flex-1">
                        <label>类型 <span class="required">*</span></label>
                        <select id="pf-type" required>
                            <option value="tcp">TCP</option>
                            <option value="udp">UDP</option>
                            <option value="http">HTTP</option>
                            <option value="https">HTTPS</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group flex-2">
                        <label>本地 IP</label>
                        <input type="text" id="pf-local-ip" value="127.0.0.1" placeholder="127.0.0.1">
                    </div>
                    <div class="form-group flex-1">
                        <label>本地端口 <span class="required">*</span></label>
                        <input type="number" id="pf-local-port" placeholder="22" required>
                    </div>
                </div>
                <!-- TCP/UDP fields -->
                <div id="proxy-tcp-fields">
                    <div class="form-group">
                        <label>远程端口</label>
                        <input type="number" id="pf-remote-port" placeholder="6022">
                    </div>
                </div>
                <!-- HTTP/HTTPS fields -->
                <div id="proxy-http-fields" class="hidden">
                    <div class="form-group">
                        <label>自定义域名</label>
                        <input type="text" id="pf-domains" placeholder="多个域名用逗号分隔">
                    </div>
                    <div class="form-group">
                        <label>子域名</label>
                        <input type="text" id="pf-subdomain" placeholder="可选">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-ghost" onclick="closeModal('modal-proxy')">取消</button>
                    <button type="submit" class="btn btn-primary">保存</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Version Management Modal -->
    <div class="modal-overlay hidden" id="modal-version">
        <div class="modal">
            <div class="modal-header">
                <h3>frpc 版本管理</h3>
                <button class="btn-close" id="btn-close-version" onclick="closeVersionModal()">&times;</button>
            </div>
            <div class="version-info">
                <div class="version-row">
                    <span class="version-label">当前版本</span>
                    <span id="ver-current" class="version-value">未安装</span>
                </div>
                <div class="version-row">
                    <span class="version-label">最新版本</span>
                    <span id="ver-latest" class="version-value">获取中...</span>
                    <button class="btn btn-sm btn-ghost" id="btn-check-latest">检查</button>
                </div>
            </div>
            <div class="version-actions">
                <button class="btn btn-primary btn-full" id="btn-install-online">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3" />
                    </svg>
                    在线安装 / 更新
                </button>
                <div class="upload-area" id="upload-area">
                    <input type="file" id="upload-file" accept=".tar.gz,.tgz" hidden>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="1.5">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12" />
                    </svg>
                    <p>离线安装：点击或拖拽 .tar.gz 文件到此处</p>
                </div>
                <div class="frpc-github-link">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6M15 3h6v6M10 14L21 3" />
                    </svg>
                    <span>无法联网？前往 <a href="https://github.com/fatedier/frp/releases" target="_blank">frp 官方 GitHub</a>
                        手动下载 <code>frp_*_linux_amd64.tar.gz ，如果是arm系统，则下载frp_*_linux_arm64.tar.gz</code> 后上传安装</span>
                </div>
            </div>
            <div id="version-progress" class="hidden">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
                <p id="version-status" class="text-muted">处理中...</p>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast-container"></div>

    <script src="app.js"></script>
</body>

</html>